{"ast":null,"code":"import { AddFeeDetailService } from 'src/app/services/add-fee-detail/add-fee-detail.service';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/add-fee-detail/add-fee-detail.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../shared/pipes/format-display-currency.pipe\";\nimport * as i5 from \"src/app/shared/pipes/sanitize-html.pipe\";\nfunction ReviewFeeDetailComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"h2\", 3);\n    i0.ɵɵtext(2, \"Payment details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\")(4, \"tbody\")(5, \"tr\", 4)(6, \"td\", 5);\n    i0.ɵɵtext(7, \"CCD Case reference:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"tr\", 4)(11, \"td\", 5);\n    i0.ɵɵtext(12, \"Fee code:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"tr\", 4)(16, \"td\", 5);\n    i0.ɵɵtext(17, \"Fee description:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"td\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"tr\", 4)(21, \"td\", 5);\n    i0.ɵɵtext(22, \"Price:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"td\");\n    i0.ɵɵtext(24);\n    i0.ɵɵpipe(25, \"formatDisplayCurrency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"tr\", 4)(27, \"td\", 5);\n    i0.ɵɵtext(28, \"Help with fees (HWF) code:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"td\");\n    i0.ɵɵtext(30);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(31, \"tr\", 4)(32, \"td\", 5);\n    i0.ɵɵtext(33, \"Amount left to pay:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"td\");\n    i0.ɵɵtext(35);\n    i0.ɵɵpipe(36, \"formatDisplayCurrency\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(37, \"div\", 6)(38, \"ol\", 7)(39, \"li\", 8)(40, \"a\", 9);\n    i0.ɵɵlistener(\"click\", function ReviewFeeDetailComponent_div_0_Template_a_click_40_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.onGoBack());\n    });\n    i0.ɵɵtext(41, \"Back to Add fee details page\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(42, \"div\", 10)(43, \"div\", 11)(44, \"div\", 12);\n    i0.ɵɵlistener(\"click\", function ReviewFeeDetailComponent_div_0_Template_div_click_44_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.sendPayDetailsToPayhub());\n    });\n    i0.ɵɵtext(45, \" Confirm fees \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(ctx_r0.payModel.ccd_case_number);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.fee ? ctx_r0.fee.code : \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.fee ? ctx_r0.fee.description : \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(25, 6, ctx_r0.fee.calculated_amount));\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.remissionModel.hwf_reference);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(36, 8, ctx_r0.payModel.amount));\n  }\n}\nfunction ReviewFeeDetailComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 13);\n    i0.ɵɵpipe(1, \"sanitizeHtml\");\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"innerHTML\", i0.ɵɵpipeBind1(1, 1, ctx_r1.payBubbleView), i0.ɵɵsanitizeHtml);\n  }\n}\nexport let ReviewFeeDetailComponent = /*#__PURE__*/(() => {\n  class ReviewFeeDetailComponent {\n    router;\n    addFeeDetailService;\n    fee = null;\n    payBubbleView;\n    constructor(router, addFeeDetailService) {\n      this.router = router;\n      this.addFeeDetailService = addFeeDetailService;\n      this.fee = this.addFeeDetailService.selectedFee;\n    }\n    get payModel() {\n      return this.addFeeDetailService.paymentModel;\n    }\n    get remissionModel() {\n      return this.addFeeDetailService.remissionModel;\n    }\n    sendPayDetailsToPayhub() {\n      if (this.payModel.amount === 0) {\n        this.addFeeDetailService.postFullRemission().then(response => {\n          const remissionData = JSON.parse(response).data;\n          this.addFeeDetailService.remissionRef = remissionData.remission_reference;\n          this.router.navigate(['/confirmation']);\n        }).catch(err => {\n          this.navigateToServiceFailure();\n        });\n      } else if (this.fee.calculated_amount > this.payModel.amount) {\n        let paymentResp;\n        this.addFeeDetailService.postPartialPayment().then(response => {\n          paymentResp = JSON.parse(response).data;\n          return this.addFeeDetailService.postPartialRemission(paymentResp.payment_group_reference, paymentResp.fees[0].id);\n        }).then(() => {\n          const url = paymentResp._links.next_url.href;\n          return this.addFeeDetailService.postPaymentUrl(url);\n        }).then(urlResp => {\n          this.payBubbleView = urlResp;\n        }).catch(err => {\n          this.navigateToServiceFailure();\n        });\n      } else {\n        this.addFeeDetailService.postPayment().then(response => {\n          this.payBubbleView = response;\n        }).catch(err => {\n          this.navigateToServiceFailure();\n        });\n      }\n    }\n    navigateToServiceFailure() {\n      this.router.navigate(['/service-failure']);\n    }\n    onGoBack() {\n      return this.router.navigate(['/addFeeDetail']);\n    }\n    static ɵfac = function ReviewFeeDetailComponent_Factory(t) {\n      return new (t || ReviewFeeDetailComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.AddFeeDetailService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ReviewFeeDetailComponent,\n      selectors: [[\"app-review-fee-detail\"]],\n      decls: 2,\n      vars: 2,\n      consts: [[\"class\", \"govuk-width-container\", 4, \"ngIf\"], [\"id\", \"payment-bubble-view-id\", 3, \"innerHTML\", 4, \"ngIf\"], [1, \"govuk-width-container\"], [1, \"heading-large\"], [1, \"section\"], [1, \"heading-small\"], [1, \"govuk-breadcrumbs\"], [1, \"govuk-breadcrumbs__list\"], [1, \"govuk-breadcrumbs__list-item\"], [\"href\", \"javascript:void(0)\", 1, \"govuk-back-link\", \"govuk-label\", 3, \"click\"], [1, \"form-group\"], [1, \"button-grid__button\"], [\"type\", \"submit\", 1, \"button\", \"button-view\", 3, \"click\"], [\"id\", \"payment-bubble-view-id\", 3, \"innerHTML\"]],\n      template: function ReviewFeeDetailComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, ReviewFeeDetailComponent_div_0_Template, 46, 10, \"div\", 0);\n          i0.ɵɵtemplate(1, ReviewFeeDetailComponent_div_1_Template, 2, 3, \"div\", 1);\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"ngIf\", !ctx.payBubbleView);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.payBubbleView);\n        }\n      },\n      dependencies: [i3.NgIf, i4.FormatDisplayCurrencyPipe, i5.SanitizeHtmlPipe],\n      styles: [\".fee-details[_ngcontent-%COMP%]{font-size:16px;background-color:#fff;width:850px;overflow-y:scroll}\"]\n    });\n  }\n  return ReviewFeeDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}