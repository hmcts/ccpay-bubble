{"ast":null,"code":"import { FeeDetailsComponent } from './../fee-details/fee-details.component';\nimport { PaymentGroupService } from '../../services/payment-group/payment-group.service';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport * as ls from 'local-storage';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../services/payment-group/payment-group.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"fee-register-search\";\nimport * as i5 from \"../fee-details/fee-details.component\";\nfunction FeeSearchComponent_a_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 7);\n    i0.ɵɵtext(1, \"Back\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"href\", \"/fee-search?ccdCaseNumber=\" + ctx_r0.ccdNo + \"&selectedOption=\" + ctx_r0.selectedOption + \"&takePayment=true\" + ctx_r0.bulkScanningTxt + \"\", i0.ɵɵsanitizeUrl);\n  }\n}\nfunction FeeSearchComponent_a_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 7);\n    i0.ɵɵtext(1, \"Back\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"href\", \"/payment-history/\" + ctx_r1.ccdNo + \"?view=case-transactions&selectedOption=\" + ctx_r1.selectedOption + \"&dcn=\" + ctx_r1.dcnNo + \"&takePayment=true\" + ctx_r1.bulkScanningTxt + \"\", i0.ɵɵsanitizeUrl);\n  }\n}\nfunction FeeSearchComponent_legend_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"legend\")(1, \"h1\", 8);\n    i0.ɵɵtext(2, \"Search for a fee\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"input\", 9, 10);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FeeSearchComponent_pay_fee_register_search_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"pay-fee-register-search\", 11);\n    i0.ɵɵlistener(\"selectedFeeEvent\", function FeeSearchComponent_pay_fee_register_search_6_Template_pay_fee_register_search_selectedFeeEvent_0_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.selectFee($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"APIRoot\", \"api\");\n  }\n}\nfunction FeeSearchComponent_app_fee_details_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-fee-details\", 12);\n    i0.ɵɵlistener(\"restartSearchEvent\", function FeeSearchComponent_app_fee_details_7_Template_app_fee_details_restartSearchEvent_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.onGoBack());\n    })(\"submitFeeVolumeEvent\", function FeeSearchComponent_app_fee_details_7_Template_app_fee_details_submitFeeVolumeEvent_0_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.selectPreselectedFeeWithVolume($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"fee\", ctx_r4.preselectedFee);\n  }\n}\nexport let FeeSearchComponent = /*#__PURE__*/(() => {\n  class FeeSearchComponent {\n    activatedRoute;\n    router;\n    paymentGroupService;\n    outputEmitterFeesDetails;\n    selectedFee;\n    ccdNo = null;\n    dcnNo = null;\n    preselectedFee;\n    showFeeDetails = false;\n    paymentGroupRef = null;\n    selectedOption = null;\n    bulkScanningTxt = '&isBulkScanning=Enable&isTurnOff=Enable';\n    isDiscontinuedFeatureEnabled = true;\n    lsCcdNumber = ls.get('ccdNumber');\n    constructor(activatedRoute, router, paymentGroupService) {\n      this.activatedRoute = activatedRoute;\n      this.router = router;\n      this.paymentGroupService = paymentGroupService;\n    }\n    ngOnInit() {\n      this.ccdNo = this.activatedRoute.snapshot.queryParams['ccdCaseNumber'];\n      this.paymentGroupRef = this.activatedRoute.snapshot.queryParams['paymentGroupRef'];\n      this.dcnNo = this.activatedRoute.snapshot.queryParams['dcn'];\n      this.selectedOption = this.activatedRoute.snapshot.queryParams['selectedOption'];\n      this.bulkScanningTxt = this.activatedRoute.snapshot.queryParams['isBulkScanning'] === 'Enable' ? '&isBulkScanning=Enable' : '&isBulkScanning=Disable';\n      this.bulkScanningTxt += this.activatedRoute.snapshot.queryParams['isTurnOff'] === 'Enable' ? '&isTurnOff=Enable' : '&isTurnOff=Disable';\n      this.bulkScanningTxt += this.activatedRoute.snapshot.queryParams['isStFixEnable'] === 'Enable' ? '&isStFixEnable=Enable' : '&isStFixEnable=Disable';\n      this.bulkScanningTxt += `&caseType=${this.activatedRoute.snapshot.queryParams['caseType']}`;\n      this.bulkScanningTxt += this.activatedRoute.snapshot.queryParams['isOldPcipalOff'] === 'Enable' ? '&isOldPcipalOff=Enable' : '&isOldPcipalOff=Disable';\n      this.bulkScanningTxt += this.activatedRoute.snapshot.queryParams['isNewPcipalOff'] === 'Enable' ? '&isNewPcipalOff=Enable' : '&isNewPcipalOff=Disable';\n      this.bulkScanningTxt += this.activatedRoute.snapshot.queryParams['isPaymentStatusEnabled'] === 'Enable' ? '&isPaymentStatusEnabled=Enable' : '&isPaymentStatusEnabled=Disable';\n      if (this.lsCcdNumber !== this.ccdNo) {\n        this.router.navigateByUrl('/ccd-search?takePayment=true');\n      }\n      this.paymentGroupService.getDiscontinuedFrFeature().then(status => {\n        this.isDiscontinuedFeatureEnabled = status;\n      });\n    }\n    selectFee(fee) {\n      const feeType = fee.fee_type;\n      const volAmt = fee.current_version ? fee.current_version['volume_amount'] : fee.fee_versions['volume_amount'];\n      const flatAmt = fee.current_version ? fee.current_version['flat_amount'] : fee.fee_versions['flat_amount'];\n      const percentageAmt = fee.current_version ? fee.current_version['percentage_amount'] : fee.fee_versions['percentage_amount'];\n      let paymentGroup;\n      const feeDetailsComponent = new FeeDetailsComponent(null, null);\n      if (feeType === 'fixed' && volAmt || feeType === 'banded' && flatAmt || feeType === 'rateable' && flatAmt || feeType === 'ranged' && percentageAmt || this.isDiscontinuedFeatureEnabled && fee.fee_versions.length > 0 && feeDetailsComponent.validOldFeesVersions(fee).length > 0) {\n        this.preselectedFee = fee;\n        this.showFeeDetails = true;\n      } else if (fee.current_version === undefined && this.isDiscontinuedFeatureEnabled && fee.fee_versions.length > 0 && feeDetailsComponent.validOldFeesVersions(fee).length > 0) {\n        this.preselectedFee = fee;\n        this.showFeeDetails = true;\n      } else if (fee.current_version !== undefined) {\n        paymentGroup = {\n          fees: [{\n            code: fee.code,\n            version: fee['current_version'].version.toString(),\n            'calculated_amount': fee['current_version'].flat_amount.amount.toString(),\n            'memo_line': fee['current_version'].memo_line,\n            'natural_account_code': fee['current_version'].natural_account_code,\n            'ccd_case_number': this.ccdNo,\n            jurisdiction1: fee.jurisdiction1['name'],\n            jurisdiction2: fee.jurisdiction2['name'],\n            description: fee.current_version.description,\n            volume: fee.fee_type === 'relational' ? null : 1,\n            fee_amount: fee['current_version'].flat_amount.amount.toString()\n          }]\n        };\n        this.sendPaymentGroup(paymentGroup);\n      }\n    }\n    onGoBack() {\n      this.preselectedFee = null;\n      this.showFeeDetails = false;\n    }\n    selectPreselectedFeeWithVolume(submitFeeVolumeEvent) {\n      this.outputEmitterFeesDetails = submitFeeVolumeEvent;\n      let selectedFeeVersion = this.outputEmitterFeesDetails.selectedVersionEmit;\n      const fee = this.preselectedFee;\n      if (selectedFeeVersion === null || typeof selectedFeeVersion === 'undefined') {\n        selectedFeeVersion = fee['current_version'];\n      }\n      const volAmt = selectedFeeVersion['volume_amount'];\n      const flatAmt = selectedFeeVersion['flat_amount'];\n      const percentageAmt = selectedFeeVersion['percentage_amount'];\n      const fee_amount = volAmt ? volAmt.amount : flatAmt ? flatAmt.amount : percentageAmt.percentage;\n      const amount = fee_amount ? fee_amount : percentageAmt;\n      const feeType = fee.fee_type;\n      const calculatedAmt = feeType === 'rateable' && flatAmt || feeType === 'ranged' && percentageAmt ? this.outputEmitterFeesDetails.volumeAmount : (fee_amount * this.outputEmitterFeesDetails.volumeAmount).toString();\n      const paymentGroup = {\n        fees: [{\n          code: fee.code,\n          version: selectedFeeVersion.version.toString(),\n          'calculated_amount': calculatedAmt,\n          'memo_line': selectedFeeVersion.memo_line,\n          'natural_account_code': selectedFeeVersion.natural_account_code,\n          'ccd_case_number': this.ccdNo,\n          jurisdiction1: fee.jurisdiction1['name'],\n          jurisdiction2: fee.jurisdiction2['name'],\n          description: selectedFeeVersion.description,\n          volume: feeType === 'rateable' && flatAmt || feeType === 'ranged' && percentageAmt ? null : this.outputEmitterFeesDetails.volumeAmount,\n          fee_amount: amount\n        }]\n      };\n      this.sendPaymentGroup(paymentGroup);\n    }\n    sendPaymentGroup(paymentGroup) {\n      const dcnQueryParams = this.dcnNo ? `&dcn=${this.dcnNo}` : '';\n      if (this.paymentGroupRef) {\n        this.paymentGroupService.putPaymentGroup(this.paymentGroupRef, paymentGroup).then(response => {\n          // tslint:disable-next-line:max-line-length\n          let url = `/payment-history/${this.ccdNo}?view=fee-summary&selectedOption=${this.selectedOption}&paymentGroupRef=${this.paymentGroupRef}${dcnQueryParams}${this.bulkScanningTxt}`;\n          url = url.replace(/[\\r\\n]+/g, ' ');\n          this.router.navigateByUrl(url);\n        }).catch(err => {\n          this.navigateToServiceFailure();\n        });\n      } else {\n        this.paymentGroupService.postPaymentGroup(paymentGroup).then(paymentGroupReceived => {\n          // tslint:disable-next-line:max-line-length\n          let url = `/payment-history/${this.ccdNo}?view=fee-summary&selectedOption=${this.selectedOption}&paymentGroupRef=${JSON.parse(paymentGroupReceived)['data'].payment_group_reference}${dcnQueryParams}${this.bulkScanningTxt}`;\n          url = url.replace(/[\\r\\n]+/g, ' ');\n          this.router.navigateByUrl(url);\n        }).catch(err => {\n          this.navigateToServiceFailure();\n        });\n      }\n    }\n    navigateToServiceFailure() {\n      this.router.navigateByUrl('/service-failure');\n    }\n    static ɵfac = function FeeSearchComponent_Factory(t) {\n      return new (t || FeeSearchComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.PaymentGroupService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FeeSearchComponent,\n      selectors: [[\"app-fee-search\"]],\n      decls: 8,\n      vars: 5,\n      consts: [[1, \"govuk-breadcrumbs\"], [1, \"govuk-breadcrumbs__list\"], [1, \"govuk-breadcrumbs__list-item\"], [\"class\", \"govuk-back-link\", 3, \"href\", 4, \"ngIf\"], [4, \"ngIf\"], [3, \"APIRoot\", \"selectedFeeEvent\", 4, \"ngIf\"], [3, \"fee\", \"restartSearchEvent\", \"submitFeeVolumeEvent\", 4, \"ngIf\"], [1, \"govuk-back-link\", 3, \"href\"], [1, \"heading-xlarge\"], [\"type\", \"hidden\", \"value\", \"SEARCHFEES\", 1, \"iFrameDrivenImageValue\"], [\"myInput\", \"\"], [3, \"APIRoot\", \"selectedFeeEvent\"], [3, \"fee\", \"restartSearchEvent\", \"submitFeeVolumeEvent\"]],\n      template: function FeeSearchComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"ol\", 1)(2, \"li\", 2);\n          i0.ɵɵtemplate(3, FeeSearchComponent_a_3_Template, 2, 1, \"a\", 3);\n          i0.ɵɵtemplate(4, FeeSearchComponent_a_4_Template, 2, 1, \"a\", 3);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(5, FeeSearchComponent_legend_5_Template, 5, 0, \"legend\", 4);\n          i0.ɵɵtemplate(6, FeeSearchComponent_pay_fee_register_search_6_Template, 1, 1, \"pay-fee-register-search\", 5);\n          i0.ɵɵtemplate(7, FeeSearchComponent_app_fee_details_7_Template, 1, 1, \"app-fee-details\", 6);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.showFeeDetails);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.showFeeDetails);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.showFeeDetails);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.showFeeDetails);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.showFeeDetails);\n        }\n      },\n      dependencies: [i3.NgIf, i4.FeeRegisterSearchComponent, i5.FeeDetailsComponent]\n    });\n  }\n  return FeeSearchComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}